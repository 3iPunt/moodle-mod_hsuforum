define(["jquery","core/notification","core/ajax","core/templates","core/fragment","core/str"],function(a,b,c,d,e){return{advancedEditor:function(b,c){var f=function(b,c,f,g,h){var i=f.find('div[id^="editor-target-container-"]:not([id$="editable"]).hsuforum-textarea'),j=f.find('div[id^="editor-target-container-"].editor_atto_content'),k=f.find('input[name="itemid"]'),l=0,m=f.find("#hsuforum-post-type");if("edit"===m.attr("value")&&(l=k.val()),"advanced"===b){var n,o,p=a("input[name='contextid']").val(),q=i.attr("id");n={contextid:p,cmid:g,id:q,draftitemid:l},e.loadFragment("mod_hsuforum","editor",p,n).done(function(b,c){h.attr("aria-pressed","false"),d.replaceNodeContents(a("#editor-info"),b,c),f.find(".hsuforum-use-advanced").text(M.util.get_string("hideadvancededitor","hsuforum")),i.html().length>0&&(o=setInterval(function(){var a=f.find('div[id^="editor-target-container-"].editor_atto_content');1==a.length&&(a.html(i.html()),clearInterval(o))},100))})}else"simple"===b?(h.attr("aria-pressed","false"),i.html(j.html()),i.show(),i.removeAttr("hidden"),c.hide(),f.find(".hsuforum-use-advanced").text(M.util.get_string("useadvancededitor","hsuforum"))):"show"===b&&(h.attr("aria-pressed","false"),f.find(".hsuforum-use-advanced").text(M.util.get_string("hideadvancededitor","hsuforum")),j.html(i.html()),i.hide(),c.show())},g=function(a,b){var c="advanced",d=a.find(".editor_atto"),e=a.find(".mceEditor"),g="";1!==d.length&&1!==e.length||(c=a.find(".hsuforum-use-advanced").text()===M.util.get_string("useadvancededitor","hsuforum")?"show":"simple"),g=d.length?d:e;var h=a.find(".hsuforum-use-advanced");h.attr("aria-pressed","true"),f(c,g,a,b,h)};a(b).on({click:function(b){if(b.preventDefault(),"false"==a(b.target).attr("aria-pressed")){var d=a(b.target).parent(".hsuforum-post-body");0===d.length&&(d=a(b.target).parent(".editor_atto_wrap")),g(d,c)}}},".hsuforum-use-advanced")},initialize:function(a,b){this.advancedEditor(a,b)}}});