define(["jquery","core/notification","core/ajax","core/templates","core/fragment","core/str"],function(a,b,c,d,e){return{advancedEditor:function(b,c){var f=function(b,c,f,g){var h=f.find('div[id^="editor-target-container-"].hsuforum-textarea'),i=f.find('div[id^="editor-target-container-"].editor_atto_content'),j=f.find('input[name="itemid"]'),k=0,l=M.util.get_string("addareply","hsuforum"),m=f.parent().find("legend");if(1===j.length&&0===a("#page-mod-hsuforum-view").length&&m.text()!=l&&(k=j.val()),"advanced"===b){var n,o,p=a("input[name='contextid']").val(),q=h.attr("id");n={contextid:p,cmid:g,id:q,draftitemid:k},e.loadFragment("mod_hsuforum","editor",p,n).done(function(b,c){d.replaceNodeContents(a("#editor-info"),b,c),f.find(".hsuforum-use-advanced").text(M.util.get_string("hideadvancededitor","hsuforum")),h.html().length>0&&(o=setInterval(function(){var a=f.find('div[id^="editor-target-container-"].editor_atto_content');1==a.length&&(a.html(h.html()),clearInterval(o))},100))})}else"simple"===b?(h.html(i.html()),h.show(),c.hide(),f.find(".hsuforum-use-advanced").text(M.util.get_string("useadvancededitor","hsuforum"))):"show"===b&&(f.find(".hsuforum-use-advanced").text(M.util.get_string("hideadvancededitor","hsuforum")),i.html(h.html()),h.hide(),c.show())},g=function(a,b){var c="advanced",d=a.find(".editor_atto"),e=a.find(".mceEditor"),g="";(1===d.length||1===e.length)&&(c=a.find(".hsuforum-use-advanced").text()===M.util.get_string("useadvancededitor","hsuforum")?"show":"simple"),g=d.length?d:e,f(c,g,a,b)};a(b).on({click:function(b){b.preventDefault();var d=a(b.target).parent(".hsuforum-post-body");0===d.length&&(d=a(b.target).parent(".editor_atto_wrap")),g(d,c)}},".hsuforum-use-advanced")},initialize:function(a,b){this.advancedEditor(a,b)}}});